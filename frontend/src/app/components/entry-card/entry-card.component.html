<a class="card" [routerLink]="['/entries', entry().id]" [class.hasFailedJob]="hasFailedJob()">
  <div class="thumbCol">
    <div class="thumb">
      <img [src]="thumbnailUrl()" alt="" (error)="onImgError($event)" />
      @if (youtubeId()) {
        <button class="playBtn" type="button" (click)="openVideo($event)">▶</button>
      }
    </div>
    <div class="thumbActions">
      <button class="iconBtn" type="button" title="Open link in new tab" (click)="openLink($event)">
        <span>↗</span>
      </button>
      <button
        class="iconBtn"
        [class.loading]="enrichJobs().length > 0"
        type="button"
        title="Update via LLM"
        (click)="enqueueEnrich($event)"
        [disabled]="busy()"
      >
        @if (enrichJobs().length > 0) {
          <span class="spinner">⟳</span>
          @if (enrichJobs().length > 1) {
            <span class="badge">{{ enrichJobs().length }}</span>
          }
        } @else {
          <span>AI</span>
        }
      </button>
      <button
        class="iconBtn"
        [class.loading]="thumbJobs().length > 0"
        type="button"
        title="Regenerate thumbnail"
        (click)="enqueueThumbnail($event)"
        [disabled]="busy()"
      >
        @if (thumbJobs().length > 0) {
          <span class="spinner">⟳</span>
          @if (thumbJobs().length > 1) {
            <span class="badge">{{ thumbJobs().length }}</span>
          }
        } @else {
          <span>Img</span>
        }
      </button>
      <button
        class="iconBtn"
        [class.active]="entry().important"
        type="button"
        title="Toggle important"
        (click)="onToggleImportant($event)"
        [disabled]="busy()"
      >
        ★
      </button>
      <button
        class="iconBtn danger"
        type="button"
        title="Delete"
        (click)="onDelete($event)"
        [disabled]="busy()"
      >
        ✖
      </button>
    </div>
  </div>
  <div class="body">
    @if (entry().aiSafe === false) {
      <div class="aiBlocked" (click)="toggleAiContext($event)">
        <span class="warningIcon">⚠️</span> AI Blocked - Content Prohibited
        <button class="expandBtn">{{ showAiContext() ? 'Hide Context' : 'Show Context' }}</button>
      </div>
      @if (showAiContext() && entry().aiContext) {
        <pre class="aiContextBox">{{ entry().aiContext }}</pre>
      }
    }

    <div class="titleRow">
      <div class="title">{{ entry().title || entry().url }}</div>
      <div class="meta">
        @if (entry().visitedAt) {
          <span class="pill">Visited</span>
        }
      </div>
    </div>
    <div class="date">Added {{ entry().createdAt | date: 'MMM d, y' }}</div>
    @if (entry().description) {
      <div class="desc">{{ entry().description }}</div>
    }
    @if (entry().tags!.length > 0) {
      <div class="tags">
        @for (tag of entry().tags!; track tag) {
          <span class="tag">{{ tag }}</span>
        }
      </div>
    }
  </div>
</a>
